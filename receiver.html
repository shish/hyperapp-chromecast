<!DOCTYPE html>
<html lang="en">

<head>
    <title>HyperCast Receiver Demo</title>
    <meta charset="UTF-8">
    <!-- Cast API must be included before anything else, and it can't be bundled -->
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script type="module">
        import { h, text, app } from "https://unpkg.com/hyperapp";
        import { ReceiverSub } from "./src/receiver.js";

        app({
            init: { video_url: null },
            view: (state) => h("main", {}, [
                state.video_url ?
                h("h1", {}, text("Video:" + state.video_url)) : h("h1", {}, text("No video")),
            ]),
            subscriptions: (state) => [
                ReceiverSub({
                    loadMessageInterceptor: function (loadRequestData) {
                        // Our demo app sends a full URL in loadRequestData.media.contentId,
                        // but some people might just send the ID and we need to set
                        // media.contentUrl for ourselves.
                        console.log("Got a LOAD request:", loadRequestData);
                        /*
                        loadRequestData.media.contentId = item.stream.dash;
                        loadRequestData.media.contentType = 'application/dash+xml';
                        loadRequestData.media.metadata = metadata;
                        */
                        //loadRequestData.media.contentUrl = loadRequestData.media.contentId;
                        //loadRequestData.media.contentId = null;

                        /*
                        let metadata = new cast.framework.messages.GenericMediaMetadata();
                        metadata.title = "My Title";
                        metadata.subtitle = "My Description";
                        loadRequestData.media.metadata = metadata;
                        loadRequestData.media.contentType = 'video/mp4';
                        */

                        return loadRequestData;
                    },
                    onMessageLoad: function (state, data) {
                        return { ...state, video_url: data.media.contentUrl };
                    },
                })
            ],
            node: document.getElementById("app"),
        })
    </script>
</head>

<body>
    <!--
        for some reason the casting API doesn't like it when this element is
        dynamically generated by hyperapp :(
    -->
    <cast-media-player></cast-media-player>
    <main id="app"></main>
</body>

</html>
